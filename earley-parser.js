var Grammar,Tokenizer,copyState,debugNestedArrays,debugState,equalArrays,getNext,bind=function(e,t){return function(){return e.apply(t,arguments)}},slice=[].slice;getNext=function(e){return e.pos<e.rhs.length?e.rhs[e.pos]:null},copyState=function(e){return{lhs:e.lhs,rhs:e.rhs,pos:e.pos,ori:e.ori,got:e.got.slice(0)}},equalArrays=function(e,t){var n,r,s,i,o;if(e.length!==t.length)return!1;for(s=i=0,o=e.length;i<o;s=++i)if(n=e[s],r=t[s],n instanceof RegExp){if(!(r instanceof RegExp)||n.source!==r.source)return!1}else if(n!==r)return!1;return!0},Grammar=function(){function e(e){this.START=e,this.parse=bind(this.parse,this),this.addRule=bind(this.addRule,this),this.setOption=bind(this.setOption,this),this.rules={},this.defaults={addCategories:!0,collapseBranches:!1,showDebuggingOutput:!1,expressionBuilder:null,tokenizer:null,comparator:JSON.equals,maxIterations:-1}}return e.prototype.setOption=function(e,t){return this.defaults[e]=t},e.prototype.addRule=function(){var e,t,n,r,s,i,o,u,a,l,h;for(t=arguments[0],a=[],s=0,i=(h=2<=arguments.length?slice.call(arguments,1):[]).length;s<i;s++){for((l=h[s])instanceof RegExp&&(l=[l]),l instanceof Array||(l=(""+l).split(" ")),r=u=0,o=l.length;u<o;r=++u)(n=l[r])instanceof RegExp&&(l[r]=new RegExp("^"+n.source+"$"));a.push((null!=(e=this.rules)[t]?e[t]:e[t]=[]).push(l))}return a},e.prototype.parse=function(e,t){var n,r,s,i,o,u,a,l,h,p,f,g,c,d,x,y,m,b,k,O,S,w,N,z,A,T,B,R,v,E,j,q,G,I,J,C,D,M,F,P,U,$,H,K,L,Q,V;for(null==t&&(t={}),null==t.addCategories&&(t.addCategories=this.defaults.addCategories),null==t.collapseBranches&&(t.collapseBranches=this.defaults.collapseBranches),null==t.showDebuggingOutput&&(t.showDebuggingOutput=this.defaults.showDebuggingOutput),null==t.expressionBuilder&&(t.expressionBuilder=this.defaults.expressionBuilder),s={},null==t.tokenizer&&(t.tokenizer=this.defaults.tokenizer),null==t.comparator&&(t.comparator=this.defaults.comparator),null==t.maxIterations&&(t.maxIterations=this.defaults.maxIterations),(r=t.showDebuggingOutput?function(){return console.log.apply(console,arguments)}:function(){})("\n\n"),null!=t.tokenizer&&"string"==typeof e&&(e=t.tokenizer.tokenize(e)),(P=function(){var t,n,r;for(r=[],u=t=0,n=e.length;0<=n?t<=n:t>=n;u=0<=n?++t:--t)r.push([]);return r}())[0].push({lhs:"",rhs:[this.START],pos:0,ori:0,got:[]}),k=0,u=h=0,p=P.length;h<p;u=++h){for(U=P[u],r("processing stateSet "+u+" in this stateGrid (with input "+e+"):"),r("----------------------"),H=y=0,A=P.length;0<=A?y<A:y>A;H=0<=A?++y:--y){for(r("|    state set "+H+":"),M=0,K=m=0,T=P[H].length;0<=T?m<T:m>T;K=0<=T?++m:--m)P[H].length<15||P[H][K].pos>0?r("|        entry "+K+": "+debugState(P[H][K])):M++;M>0&&r("|    (plus "+M+" at pos 0 not shown)")}for(r("----------------------"),a=0;a<U.length;)if(F=U[a],r("entry "+a+":",debugState(F)),b=getNext(F),r("next:",b),null!==b)if(u>=e.length)a++;else if(r("is it a terminal?",b instanceof RegExp),b instanceof RegExp)b.test(e[u])&&((n=copyState(F)).pos++,n.got.push(e[u]),P[u+1].push(n),r("scanner added this to "+(u+1)+":",debugState(n))),a++;else{if(!this.rules.hasOwnProperty(b))throw"Unknown non-terminal in grammar rule: "+b;for(r("rhss: ["+(C=this.rules[b]).join("],[")+"]"),l=w=0,g=C.length;w<g;l=++w){for(J=C[l],i=!1,N=0,c=U.length;N<c;N++)if((D=U[N]).lhs===b&&equalArrays(D.rhs,J)&&0===D.pos){i=!0;break}i||(U.push({lhs:b,rhs:J,pos:0,ori:u,got:[]}),r("adding this state:",debugState(U[U.length-1])))}if(a++,k++>(v=t.maxIterations)&&v>0)throw"Maximum number of iterations reached."}else{for(r("considering if this completion matters to state set",F.ori),l=O=0,f=(B=P[F.ori]).length;O<f;l=++O)if(D=B[l],getNext(D)===F.lhs&&(D=copyState(D),D.pos++,o=F.got.slice(0),t.addCategories&&o.unshift(F.lhs),null!=t.expressionBuilder&&o.unshift(s),t.collapseBranches&&1===o.length&&(o=o[0]),D.got.push(o),P[u].push(D),r("completer added this to "+u+":",debugState(D)),k++>(R=t.maxIterations)&&R>0))throw"Maximum number of iterations reached.";a++}}for(r("finished processing this stateGrid (with input "+e+"):"),r("----------------------"),H=$=0,E=P.length;0<=E?$<E:$>E;H=0<=E?++$:--$){for(r("|    state set "+H+":"),M=0,K=L=0,j=P[H].length;0<=j?L<j:L>j;K=0<=j?++L:--L)P[H].length<15||P[H][K].pos>0?r("|        entry "+K+": "+debugState(P[H][K])):M++;M>0&&r("|    (plus "+M+" at pos 0 not shown)")}for(r("----------------------"),I=[],Q=0,d=(q=P[P.length-1]).length;Q<d;Q++)if(""===(U=q[Q]).lhs&&null===getNext(U)){if(G=U.got[0],null!=t.expressionBuilder&&(z=function(e){var n,r;return e instanceof Array&&e[0]===s?(1===(n=function(){var t,n,s,i;for(s=[],i=0,t=(n=e.slice(1)).length;i<t;i++)r=n[i],s.push(z(r));return s}()).length&&t.collapseBranches&&(n=n[0]),n.indexOf(void 0)>-1?void 0:t.expressionBuilder(n)):e},null==(G=z(G))))continue;for(i=!1,V=0,x=I.length;V<x;V++)if(S=I[V],t.comparator(S,G)){i=!0;break}i||I.push(G)}return I},e}(),Tokenizer=function(){function e(){this.tokenize=bind(this.tokenize,this),this.addType=bind(this.addType,this),this.tokenTypes=[]}return e.prototype.addType=function(e,t){return null==t&&(t=function(e){return e}),"^"!==e.source[0]&&(e=new RegExp("^(?:"+e.source+")")),this.tokenTypes.push({regexp:e,formatter:t})},e.prototype.tokenize=function(e){var t,n,r,s,i,o,u,a,l,h;for(a=[];e.length>0;){for(o=e.length,n=0,r=(u=this.tokenTypes).length;n<r;n++)if(h=u[n],s=h.regexp.exec(e)){if(e=e.slice(s[0].length),h.formatter instanceof Function)null!=(i=h.formatter(s[0],s))&&a.push(i);else{for(t=""+h.formatter,l="";i=/\%([0-9]+)/.exec(t);)l+=t.slice(0,i.index)+s[i[1]],t=t.slice(i.index+i[0].length);a.push(l+t)}break}if(e.length===o)return null}return a},e}(),"undefined"!=typeof exports&&null!==exports&&(exports.Grammar=Grammar,exports.Tokenizer=Tokenizer),debugNestedArrays=function(e){return e instanceof Array?("{}"===JSON.stringify(e[0])&&(e=e.slice(1)),"["+e.map(debugNestedArrays).join(",")+"]"):e},debugState=function(e){return"("+e.lhs+" -> "+e.pos+"in["+e.rhs+"], "+e.ori+") got "+debugNestedArrays(e.got)},JSON.equals=function(e,t){var n,r,s,i,o;if(e instanceof Object!=t instanceof Object)return!1;if(e instanceof Array!=t instanceof Array)return!1;if(!(e instanceof Object))return e===t;if(i=Object.keys(e).sort(),o=Object.keys(t).sort(),JSON.stringify(i)!==JSON.stringify(o))return!1;for(r=0,s=i.length;r<s;r++)if(n=i[r],!JSON.equals(e[n],t[n]))return!1;return!0};
//# sourceMappingURL=earley-parser.js.map
